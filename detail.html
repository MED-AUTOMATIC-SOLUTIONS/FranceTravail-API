<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Offres France Travail</title>
  <link rel="icon" href="logo.png" type="image/png">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-900 text-white p-4 sm:p-8 dark">
  <a href="index.html" class="text-blue-400 underline mb-4 block">← Retour à la liste</a>

  <div id="loader" class="flex justify-center items-center">
    <div class="animate-spin rounded-full border-t-4 border-blue-400 w-16 h-16"></div>
  </div>

  <div id="offre" class="bg-gray-800 max-w-4xl w-full mx-auto p-4 sm:p-6 rounded shadow hidden"></div>
  <div id="erreur" class="text-red-600 text-center mt-4"></div>

  <script>
    async function chargerDetails() {
      const params = new URLSearchParams(window.location.search);
      const id = params.get("id");

      if (!id) {
        document.getElementById("erreur").textContent = "Identifiant d'offre manquant.";
        return;
      }

      try {
        const res = await fetch(`https://francetravail-serveur.onrender.com/api/offres/${id}`);
        const data = await res.json();

        if (!data || !data.intitule) {
          document.getElementById("erreur").textContent = "Aucune donnée trouvée pour cette offre.";
          return;
        }

        document.getElementById("loader").classList.add("hidden");
        const container = document.getElementById("offre");
        container.classList.remove("hidden");

        container.innerHTML = `
          <h1 class="text-3xl font-bold mb-4">${data.intitule}</h1>
          <p class="mt-2"><strong>Entreprise :</strong> <span class="text-gray-300">${data.entreprise?.nom || "N/A"}</span></p>
          <p class="mt-2"><strong>Secteur d'activité :</strong> <span class="text-gray-300">${data.entreprise?.secteurActiviteLibelle || "N/A"}</span></p>
          <p class="mt-2">
            <strong>Offre posté le :</strong>
            <span class="text-gray-300">
              ${data.dateCreation
                ? new Date(data.dateCreation).toLocaleString('fr-FR', {
                    day: '2-digit',
                    month: 'long',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit',
                  }).replace(',', ' à')
                : "N/A"}
            </span>
          </p>
          <p class="mt-2"><strong>Lieu :</strong> <span class="text-gray-300">${data.lieuTravail?.libelle || "N/A"}</span></p>
          <p class="mt-2">
            <strong>Dernière mise à jour :</strong>
            <span class="text-gray-300">
              ${data.dateActualisation
                ? new Date(data.dateActualisation).toLocaleString('fr-FR', {
                    day: '2-digit',
                    month: 'long',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit',
                  }).replace(',', ' à')
                : "N/A"}
            </span>
          </p>
          <p class="mt-2"><strong>Type de contrat :</strong> <span class="text-gray-300">${data.typeContratLibelle || "N/A"}</span></p>
          <p class="mt-2"><strong>Date de début :</strong> <span class="text-gray-300">${data.dateDebut || "N/A"}</span></p>
          <p class="mt-2"><strong>Durée :</strong> <span class="text-gray-300">${data.dureeTravailLibelle || "N/A"}</span></p>
          <p class="mt-2"><strong>Horaires :</strong> <span class="text-gray-300">${data.tempsTravailLibelle || "N/A"}</span></p>
          <p class="mt-2"><strong>Expérience requise :</strong> <span class="text-gray-300">${data.experienceLibelle || "N/A"}</span></p>
          <p class="mt-2"><strong>Qualification :</strong> <span class="text-gray-300">${data.qualificationLibelle || "N/A"}</span></p>
          <p class="mt-2"><strong>Niveau d'étude :</strong> <span class="text-gray-300">${data.niveauEtudeLibelle || "N/A"}</span></p>
          <p class="mt-2"><strong>Langues :</strong> <span class="text-gray-300">${(data.langues || []).map(l => l.libelle + (l.niveauLibelle ? ` (${l.niveauLibelle})` : '')).join(', ') || "Non spécifiées"}</span></p>
          <p class="mt-2"><strong>Compétences :</strong> <span class="text-gray-300">${(data.competences || []).map(c => c.libelle).join(', ') || "Non spécifiées"}</span></p>
          <p class="mt-2"><strong>Permis exigés :</strong> <span class="text-gray-300">${(data.permis || []).map(p => p.libelle).join(', ') || "Aucun"}</span></p>
          <p class="mt-2"><strong>Rémunération :</strong> <span class="text-gray-300">${data.salaire?.libelle || "Non précisée"}</span></p>
          <p class="mt-2"><strong>Nombre de postes :</strong> <span class="text-gray-300">${data.nombrePostes || "Non précisé"}</span></p>
          <p class="mt-2"><strong>Description complète :</strong></p>
          <p class="mt-2 text-gray-400 whitespace-pre-line">${data.description || "Pas de description"}</p>
        `;
      } catch (err) {
        document.getElementById("erreur").textContent = "Erreur lors du chargement de l'offre.";
        console.error(err);
      }
    }

    chargerDetails();
  </script>
</body>
</html>
