<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8">
    <title>Offres France Travail</title>
    <link rel="icon" href="logo.png" type="image/png">
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
  <a href="index.html" class="text-blue-600 underline mb-4 block">← Retour à la liste</a>
  <div id="offre" class="bg-white max-w-4xl mx-auto p-6 rounded shadow"></div>
  <div id="erreur" class="text-red-600 text-center mt-4"></div>

  <script>
    async function chargerDetails() {
      const params = new URLSearchParams(window.location.search);
      const id = params.get("id");
  
      if (!id) {
        document.getElementById("erreur").textContent = "Identifiant d'offre manquant.";
        return;
      }
  
      try {
        const res = await fetch(`http://localhost:3000/api/offres/${id}`);
        const data = await res.json();
  
        if (!data || !data.intitule) {
          document.getElementById("erreur").textContent = "Aucune donnée trouvée pour cette offre.";
          return;
        }
  
        const container = document.getElementById("offre");
        container.innerHTML = `
          <h1 class="text-3xl font-bold mb-2">${data.intitule}</h1>
          <p class="mt-2"><strong>Entreprise :</strong> ${data.entreprise?.nom || "N/A"}</p>
          <p class="mt-2"><strong>Secteur d'activité :</strong> ${data.entreprise?.secteurActiviteLibelle || "N/A"}</p>
          <p class="mt-2"><strong>Lieu :</strong> ${data.lieuTravail?.libelle || "N/A"}</p>
          <p class="mt-2"><strong>Type de contrat :</strong> ${data.typeContratLibelle || "N/A"}</p>
          <p class="mt-2"><strong>Date de début :</strong> ${data.dateDebut || "N/A"}</p>
          <p class="mt-2"><strong>Durée :</strong> ${data.dureeTravailLibelle || "N/A"}</p>
          <p class="mt-2"><strong>Horaires :</strong> ${data.tempsTravailLibelle || "N/A"}</p>
          <p class="mt-2"><strong>Expérience requise :</strong> ${data.experienceLibelle || "N/A"}</p>
          <p class="mt-2"><strong>Qualification :</strong> ${data.qualificationLibelle || "N/A"}</p>
          <p class="mt-2"><strong>Niveau d'étude :</strong> ${data.niveauEtudeLibelle || "N/A"}</p>
          <p class="mt-2"><strong>Langues :</strong> ${(data.langues || []).map(l => l.libelle + (l.niveauLibelle ? ` (${l.niveauLibelle})` : '')).join(', ') || "Non spécifiées"}</p>
          <p class="mt-2"><strong>Compétences :</strong> ${(data.competences || []).map(c => c.libelle).join(', ') || "Non spécifiées"}</p>
          <p class="mt-2"><strong>Permis exigés :</strong> ${(data.permis || []).map(p => p.libelle).join(', ') || "Aucun"}</p>
          <p class="mt-2"><strong>Rémunération :</strong> ${data.salaire?.libelle || "Non précisée"}</p>
          <p class="mt-2"><strong>Nombre de postes :</strong> ${data.nombrePostes || "Non précisé"}</p>
          <p class="mt-4"><strong>Description complète :</strong></p>
          <p class="mt-2 text-gray-700 whitespace-pre-line">${data.description || "Pas de description"}</p>
        `;
      } catch (err) {
        document.getElementById("erreur").textContent = "Erreur lors du chargement de l'offre.";
        console.error(err);
      }
    }
  
    chargerDetails();
  </script>
  
</body>
</html>
